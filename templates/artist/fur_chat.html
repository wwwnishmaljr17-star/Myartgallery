<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ArtGallery Messenger | Premium Creative Workspace</title>

	<!-- Premium Fonts & Icons -->
	<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css">
	<link rel="stylesheet" href="/static/chat_style/bootstrap.min.css">

	<style>
		:root {
			--bg-deep: #0f172a;
			--card-bg: #1e293b;
			--primary: #3b82f6;
			--primary-glow: rgba(59, 130, 246, 0.4);
			--sidebar-width: 350px;
			--accent: #10b981;
			--text-main: #f8fafc;
			--text-dim: #94a3b8;
		}

		body,
		html {
			height: 100%;
			margin: 0;
			font-family: 'Outfit', sans-serif;
			background-color: var(--bg-deep);
			color: var(--text-main);
			overflow: hidden;
		}

		.messenger-container {
			display: flex;
			height: 100vh;
			width: 100vw;
			padding: 20px;
			gap: 20px;
			background: linear-gradient(135deg, #0f172a 0%, #171717 100%);
		}

		/* Sidebar - Contacts */
		.contacts-sidebar {
			width: var(--sidebar-width);
			background: var(--card-bg);
			border-radius: 24px;
			display: flex;
			flex-direction: column;
			box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
			border: 1px solid rgba(255, 255, 255, 0.05);
		}

		.sidebar-header {
			padding: 30px;
			border-bottom: 1px solid rgba(255, 255, 255, 0.05);
		}

		.home-btn {
			display: flex;
			align-items: center;
			justify-content: center;
			background: rgba(255, 255, 255, 0.05);
			color: white;
			padding: 12px 20px;
			border-radius: 12px;
			text-decoration: none !important;
			font-weight: 600;
			transition: all 0.3s;
			margin-bottom: 20px;
			border: 1px solid rgba(255, 255, 255, 0.1);
		}

		.home-btn:hover {
			background: var(--primary);
			box-shadow: 0 0 15px var(--primary-glow);
			transform: translateY(-2px);
			color: white;
		}

		.contacts-list {
			flex-grow: 1;
			overflow-y: auto;
			padding: 10px;
		}

		.contact-item {
			padding: 15px;
			margin-bottom: 8px;
			border-radius: 16px;
			cursor: pointer;
			transition: all 0.2s;
			display: flex;
			align-items: center;
			gap: 15px;
			border: 1px solid transparent;
		}

		.contact-item:hover {
			background: rgba(255, 255, 255, 0.05);
		}

		.contact-item.active {
			background: rgba(59, 130, 246, 0.1);
			border-color: rgba(59, 130, 246, 0.2);
		}

		.contact-avatar,
		.active-user-avatar {
			position: relative;
			width: 50px;
			height: 50px;
			background: rgba(255, 255, 255, 0.05);
			border-radius: 14px;
			display: flex;
			align-items: center;
			justify-content: center;
			border: 1px solid rgba(255, 255, 255, 0.1);
			overflow: visible;
		}

		.contact-avatar img,
		.active-user-avatar img {
			width: 100%;
			height: 100%;
			border-radius: 14px;
			object-fit: cover;
			display: block;
		}

		.contact-avatar.is-placeholder i,
		.active-user-avatar.is-placeholder i {
			font-size: 1.5rem;
			color: var(--primary);
		}

		.online-dot {
			position: absolute;
			bottom: -2px;
			right: -2px;
			width: 14px;
			height: 14px;
			background: var(--accent);
			border-radius: 50%;
			border: 3px solid var(--card-bg);
			z-index: 10;
		}

		.contact-info h6 {
			margin: 0;
			font-weight: 600;
			color: var(--text-main);
		}

		.contact-info p {
			margin: 0;
			font-size: 0.8rem;
			color: var(--text-dim);
		}

		/* Chat Window */
		.chat-window {
			flex-grow: 1;
			background: var(--card-bg);
			border-radius: 24px;
			display: flex;
			flex-direction: column;
			box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
			border: 1px solid rgba(255, 255, 255, 0.05);
			position: relative;
		}

		.chat-header {
			padding: 20px 30px;
			border-bottom: 1px solid rgba(255, 255, 255, 0.05);
			display: flex;
			align-items: center;
			justify-content: space-between;
		}

		.active-user-info {
			display: flex;
			align-items: center;
			gap: 15px;
		}

		.active-user-avatar {
			width: 45px;
			height: 45px;
			border-radius: 12px;
		}

		.messages-area {
			flex-grow: 1;
			padding: 30px;
			overflow-y: auto;
			display: flex;
			flex-direction: column;
			gap: 20px;
			background-image: radial-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px);
			background-size: 30px 30px;
		}

		/* Message Bubbles */
		.msg-container {
			max-width: 70%;
			display: flex;
			flex-direction: column;
		}

		.msg-incoming {
			align-self: flex-start;
		}

		.msg-outgoing {
			align-self: flex-end;
		}

		.bubble {
			padding: 14px 18px;
			border-radius: 18px;
			font-size: 0.95rem;
			line-height: 1.5;
			position: relative;
		}

		.msg-incoming .bubble {
			background: #2d3748;
			color: white;
			border-bottom-left-radius: 4px;
		}

		.msg-outgoing .bubble {
			background: var(--primary);
			color: white;
			border-bottom-right-radius: 4px;
			box-shadow: 0 4px 15px var(--primary-glow);
		}

		.msg-time {
			font-size: 0.7rem;
			color: var(--text-dim);
			margin-top: 5px;
		}

		.msg-outgoing .msg-time {
			text-align: right;
		}

		/* Input Area */
		.chat-footer {
			padding: 25px 30px;
			border-top: 1px solid rgba(255, 255, 255, 0.05);
		}

		.input-wrapper {
			background: rgba(255, 255, 255, 0.03);
			border: 1px solid rgba(255, 255, 255, 0.1);
			border-radius: 18px;
			padding: 10px 15px;
			display: flex;
			align-items: center;
			gap: 15px;
			transition: all 0.3s;
		}

		.input-wrapper:focus-within {
			background: rgba(255, 255, 255, 0.05);
			border-color: var(--primary);
		}

		.type_msg {
			background: transparent !important;
			border: none !important;
			color: white !important;
			resize: none;
			flex-grow: 1;
			padding: 8px 0;
			max-height: 80px;
		}

		.type_msg:focus {
			outline: none;
		}

		.send-btn {
			background: var(--primary);
			border: none;
			width: 45px;
			height: 45px;
			border-radius: 12px;
			color: white;
			display: flex;
			align-items: center;
			justify-content: center;
			cursor: pointer;
			transition: all 0.3s;
		}

		.send-btn:hover {
			transform: scale(1.05);
			filter: brightness(1.1);
		}

		/* Empty State */
		.empty-messenger {
			flex-grow: 1;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			text-align: center;
			opacity: 0.5;
		}

		.empty-messenger i {
			font-size: 5rem;
			margin-bottom: 20px;
			color: var(--text-dim);
		}

		/* Scrollbars */
		::-webkit-scrollbar {
			width: 6px;
		}

		::-webkit-scrollbar-track {
			background: transparent;
		}

		::-webkit-scrollbar-thumb {
			background: rgba(255, 255, 255, 0.1);
			border-radius: 10px;
		}
	</style>
</head>

<body>

	<div class="messenger-container">
		<!-- Sidebar -->
		<div class="contacts-sidebar">
			<div class="sidebar-header">
				<a href="/artistHome" class="home-btn">
					<i class="fas fa-home mr-2 text-primary"></i> Dashboard Home
				</a>
				<h5 class="font-weight-bold mb-0"><i class="fas fa-comments mr-2 text-primary"></i> Messages</h5>
			</div>
			<div class="contacts-list" id="contacts_list">
				<!-- Populated via AJAX -->
			</div>
		</div>

		<!-- Chat Area -->
		<div class="chat-window">
			<!-- Hidden Inputs for State -->
			<input type="hidden" id="rece" />

			<!-- Header -->
			<div class="chat-header" id="chat_header_ui" style="display: none;">
				<div class="active-user-info">
					<div class="active-user-avatar" id="active_avatar">
						<img src="/static/Artist/img/user.jpg" alt="">
					</div>
					<div>
						<h6 class="m-0 font-weight-bold" id="active_name">Select a Collector</h6>
						<small class="text-accent"><i class="fas fa-circle mr-1" style="font-size: 8px;"></i> Online
							Now</small>
					</div>
				</div>
				<a href="/view_profile_and_update" class="btn btn-outline-light btn-sm rounded-pill px-3">
					<i class="fas fa-user-circle mr-1"></i> My Profile
				</a>
			</div>

			<!-- Messages -->
			<div class="messages-area" id="messages_display">
				<div class="empty-messenger">
					<i class="fas fa-comment-medical animate-pulse"></i>
					<h3>Creative Sanctuary</h3>
					<p>Select a contact from the left <br>to start your masterpiece of conversation.</p>
				</div>
			</div>

			<!-- Footer / Input -->
			<div class="chat-footer" id="chat_footer_ui" style="display: none;">
				<div class="input-wrapper">
					<button class="btn btn-link text-dim p-0"><i class="fas fa-paperclip"></i></button>
					<textarea id="textfield" class="form-control type_msg"
						placeholder="Share your creative vision..."></textarea>
					<button id="button" class="send-btn">
						<i class="fas fa-paper-plane"></i>
					</button>
				</div>
			</div>
		</div>
	</div>

	<script src="/static/chat_style/jquery.min.js"></script>
	<script>
		$(document).ready(function () {
			let refreshInterval = null;

			// Fetch contacts list
			$.ajax({
				url: "/chatview",
				type: "POST",
				dataType: "json",
				success: function (data) {
					const list = $("#contacts_list");
					list.empty();
					data.forEach(user => {
						const isPlaceholder = user.photo === 'placeholder';
						const avatarContent = isPlaceholder ? '<i class="fas fa-user"></i>' : `<img src="${user.photo}" alt="">`;
						const item = `
                        <div class="contact-item" data-id="${user.loginid}" data-name="${user.name}" data-photo="${user.photo}">
                            <div class="contact-avatar ${isPlaceholder ? 'is-placeholder' : ''}">
                                ${avatarContent}
                                <span class="online-dot"></span>
                            </div>
                            <div class="contact-info">
                                <h6>${user.name}</h6>
                                <p>${user.email}</p>
                            </div>
                        </div>
                    `;
						list.append(item);
					});
				}
			});

			// Contact selection
			$(document).on('click', '.contact-item', function () {
				const uid = $(this).data('id');
				const name = $(this).data('name');
				const photo = $(this).data('photo');

				$('.contact-item').removeClass('active');
				$(this).addClass('active');

				$("#rece").val(uid);
				$("#active_name").text("Chat with " + name);

				// Update active avatar with placeholder support
				const activeAvatar = $("#active_avatar");
				const isPlaceholder = photo === 'placeholder';
				activeAvatar.empty();
				if (isPlaceholder) {
					activeAvatar.addClass('is-placeholder');
					activeAvatar.append('<i class="fas fa-user"></i>');
				} else {
					activeAvatar.removeClass('is-placeholder');
					activeAvatar.append(`<img src="${photo}" alt="">`);
				}

				$("#chat_header_ui, #chat_footer_ui").show();

				// Start polling
				if (refreshInterval) clearInterval(refreshInterval);
				fetchMessages();
				refreshInterval = setInterval(fetchMessages, 2000);
			});

			// Fetch messages
			function fetchMessages() {
				const uid = $("#rece").val();
				if (!uid) return;

				$.ajax({
					url: "/coun_msg/" + uid,
					type: "GET",
					dataType: "json",
					success: function (response) {
						const display = $("#messages_display");
						display.empty();
						response.data.forEach(msg => {
							const isOutgoing = msg.from_id != uid;
							const bubbleClass = isOutgoing ? 'msg-outgoing' : 'msg-incoming';
							const bubble = `
                            <div class="msg-container ${bubbleClass}">
                                <div class="bubble">${msg.msg}</div>
                                <div class="msg-time">${msg.date}</div>
                            </div>
                        `;
							display.append(bubble);
						});
						// Scroll to bottom
						display.scrollTop(display[0].scrollHeight);
					}
				});
			}

			// Send message
			$("#button").click(function () {
				const msg = $("#textfield").val().trim();
				const senid = $("#rece").val();
				if (!msg || !senid) return;

				$.ajax({
					url: `/coun_insert_chat/${msg}/${senid}`,
					type: "GET",
					success: function () {
						$("#textfield").val("");
						fetchMessages();
					}
				});
			});

			// Enter key to send
			$("#textfield").keypress(function (e) {
				if (e.which == 13 && !e.shiftKey) {
					e.preventDefault();
					$("#button").click();
				}
			});
		});
	</script>

</body>

</html>